<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web API Test Platform | Traffic & CityFlow Research</title>
    <!-- Inter Font for modern research look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&family=Merriweather:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --primary-light: #eff6ff;
            --secondary: #475569;
            --dark: #0f172a;
            --light: #f8fafc;
            --border: #e2e8f0;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --sidebar-width: 300px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.7;
            color: #334155;
            background-color: #f1f5f9;
            display: flex;
        }

        /* --- Custom Scrollbar --- */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* --- Reading Progress Bar --- */
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: transparent;
            z-index: 1000;
        }
        .progress-bar {
            height: 4px;
            background: var(--primary);
            width: 0%;
            transition: width 0.1s;
        }

        /* --- Sidebar Navigation --- */
        aside {
            width: var(--sidebar-width);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-right: 1px solid var(--border);
            padding: 2rem 1.5rem;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            transform: translateX(0);
            transition: transform 0.3s ease;
        }

        .logo-area {
            padding: 0 0 2rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .logo-area h1 {
            font-size: 1.25rem;
            font-weight: 800;
            color: var(--dark);
            text-transform: uppercase;
            letter-spacing: 1px;
            line-height: 1.2;
        }
        
        .logo-area span { color: var(--primary); }

        .nav-group { margin-bottom: 2rem; }
        
        .nav-group-title {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            color: #94a3b8;
            font-weight: 700;
            margin-bottom: 0.75rem;
            padding-left: 0.75rem;
        }

        nav ul { list-style: none; }
        nav li { margin-bottom: 0.2rem; }

        nav a {
            text-decoration: none;
            color: var(--secondary);
            font-size: 0.9rem;
            font-weight: 500;
            display: block;
            padding: 0.6rem 0.8rem;
            border-radius: 6px;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }

        nav a:hover {
            background: var(--light);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        nav a.active {
            background: var(--primary-light);
            color: var(--primary);
            font-weight: 600;
            border-left-color: var(--primary);
        }

        /* --- Main Content --- */
        main {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: 4rem 5rem; /* Increased padding for better reading */
            max-width: 1400px;
            width: 100%;
        }

        section {
            background: white;
            padding: 3.5rem; /* More breathing room */
            border-radius: 16px; /* Softer corners */
            margin-bottom: 3rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            border: 1px solid var(--border);
        }

        h2 {
            font-size: 2rem;
            color: var(--dark);
            margin-bottom: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        h3 {
            font-size: 1.35rem;
            color: var(--dark);
            margin: 2.5rem 0 1rem;
            font-weight: 600;
        }

        h4 {
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--secondary);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        p { margin-bottom: 1.5rem; font-size: 1.05rem; color: #334155; }
        ul { margin-bottom: 1.5rem; padding-left: 1.5rem; }
        li { margin-bottom: 0.6rem; }

        /* --- Components --- */
        .badge {
            padding: 0.3rem 0.8rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 700;
            background: var(--light);
            color: var(--secondary);
            border: 1px solid var(--border);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem; /* Wider gap */
            margin: 2rem 0;
        }

        .card {
            padding: 1.75rem;
            border: 1px solid var(--border);
            border-radius: 10px;
            transition: var(--transition);
            background: white;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 4px;
            background: var(--primary);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .card:hover { 
            border-color: var(--primary-light); 
            transform: translateY(-4px); 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .card:hover::before { transform: scaleX(1); }

        .ascii-diagram {
            font-family: 'Fira Code', monospace;
            background: var(--dark);
            color: #94a3b8;
            padding: 2rem;
            border-radius: 10px;
            overflow-x: auto;
            font-size: 0.8rem;
            line-height: 1.4;
            margin: 2rem 0;
            white-space: pre;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 2rem 0;
            border-radius: 8px;
            overflow: hidden;
            font-size: 0.9rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        th { 
            background: #f8fafc; 
            font-weight: 700; 
            text-align: left; 
            color: var(--secondary); 
            font-size: 0.8rem; 
            text-transform: uppercase; 
            letter-spacing: 0.05em;
            padding: 1rem 1.5rem; 
            border-bottom: 2px solid var(--border); 
        }
        td { padding: 1rem 1.5rem; border-bottom: 1px solid var(--border); vertical-align: top; }
        tr:last-child td { border-bottom: none; }

        .citation-box {
            background: var(--dark);
            color: #e2e8f0;
            padding: 2rem;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .copy-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 0.4rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: var(--transition);
            font-weight: 600;
        }

        .copy-btn:hover { background: var(--primary); border-color: var(--primary); transform: scale(1.05); }

        .code-block {
            background: #f1f5f9;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
            font-size: 0.85em;
            color: var(--primary-dark);
            border: 1px solid #e2e8f0;
        }

        /* Improved Math Block */
        .math-block {
            background: #ffffff;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            padding: 2rem;
            font-family: 'Merriweather', serif; /* Academic Serif */
            font-size: 1.25rem;
            text-align: center;
            margin: 2rem auto;
            max-width: 85%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: relative;
        }
        
        .math-block strong {
            display: block;
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--secondary);
            margin-bottom: 1rem;
            font-weight: 700;
        }

        /* --- Robustness Tags --- */
        .robustness-tag {
            background: #fff7ed;
            color: #c2410c;
            border: 1px solid #ffedd5;
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
        }
        
        .impact-box {
            margin-top: 1rem;
            padding: 1rem;
            background: #f8fafc;
            border-left: 4px solid var(--secondary);
            border-radius: 0 6px 6px 0;
        }

        /* --- Mobile Menu Toggle --- */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 1.5rem;
            left: 1.5rem;
            z-index: 101;
            background: white;
            border: 1px solid var(--border);
            padding: 0.5rem 0.8rem;
            border-radius: 6px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--dark);
        }

        /* --- Mobile Responsive --- */
        @media (max-width: 1024px) {
            .mobile-menu-btn { display: block; }
            
            aside { 
                transform: translateX(-100%); 
                width: 280px;
                box-shadow: 10px 0 20px rgba(0,0,0,0.1);
            }
            
            aside.mobile-open { transform: translateX(0); }
            
            main { margin-left: 0; padding: 2rem; padding-top: 5rem; }
            .grid { grid-template-columns: 1fr; }
            h2 { font-size: 1.5rem; }
            section { padding: 2rem; }
        }
    </style>
</head>
<body>

    <!-- Reading Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()">â˜°</button>

    <aside id="sidebar">
        <div class="logo-area">
            <h1>TrafficSim <span>Research</span></h1>
            <div style="font-size: 0.75rem; color: #94a3b8; margin-top: 0.5rem;">Methodology & Evaluation</div>
        </div>
        <nav id="sidebar-nav">
            <div class="nav-group">
                <div class="nav-group-title">Core</div>
                <ul>
                    <li><a href="#overview">Overview & Objectives</a></li>
                    <li><a href="#architecture">System Architecture</a></li>
                    <li><a href="#structure">Project Structure</a></li>
                    <li><a href="#deployment">Deployment</a></li>
                </ul>
            </div>
            <div class="nav-group">
                <div class="nav-group-title">Simulation & Integration</div>
                <ul>
                    <li><a href="#cityflow">CityFlow Integration</a></li>
                    <li><a href="#sumo">ğŸš¦ SUMO Compatibility</a></li>
                    <li><a href="#workflow">Experiment Workflow</a></li>
                    <li><a href="#metrics">Metrics & Evaluation</a></li>
                </ul>
            </div>
            <div class="nav-group">
                <div class="nav-group-title">Advanced Research</div>
                <ul>
                    <li><a href="#robustness">ğŸ“Š Robustness Experiments</a></li>
                    <li><a href="#rl-loop">RL Control Loop</a></li>
                    <li><a href="#marl">ğŸ•¸ï¸ Multi-Agent RL (MARL)</a></li>
                    <li><a href="#comparison">Control Strategy Comparison</a></li>
                    <li><a href="#results">Results & Analysis</a></li>
                </ul>
            </div>
            <div class="nav-group">
                <div class="nav-group-title">Meta</div>
                <ul>
                    <li><a href="#limitations">Future Work & Principles</a></li>
                    <li><a href="#citation">Citation</a></li>
                </ul>
            </div>
        </nav>
    </aside>

    <main>
        <!-- SECTION 1: OVERVIEW -->
        <section id="overview">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <div>
                    <span class="badge" style="background: var(--primary); color: white; border: none;">v2.2.0 Enterprise</span>
                    <span class="badge" style="margin-left: 0.5rem; background: #ecfdf5; color: var(--success); border-color: #d1fae5;">MIT License</span>
                </div>
            </div>
            
            <h2>Overview</h2>
            <p class="section-subtitle" style="font-size: 1.2rem; color: var(--secondary); font-weight: 300; margin-bottom: 2rem;">
                A specialized enterprise-grade framework for evaluating <strong>high-concurrency Traffic Management APIs</strong> through microscopic simulation.
            </p>
            <p>This system bridges the gap between traffic simulators (CityFlow/SUMO) and modern web architectures, enabling researchers to test not just traffic logic, but system reliability and API robustness under extreme load.</p>
            
            <div class="grid">
                <div class="card">
                    <h4>High Performance</h4>
                    <p>Go-based load generation capable of 50k+ req/sec simulation, ensuring APIs can handle peak city-scale traffic events.</p>
                </div>
                <div class="card">
                    <h4>Multi-Simulator</h4>
                    <p>Unified abstraction layer supporting CityFlow and SUMO via TraCI for algorithm cross-validation and robustness testing.</p>
                </div>
                <div class="card">
                    <h4>MARL Ready</h4>
                    <p>Native support for Multi-Agent Reinforcement Learning with cooperative reward structures and centralized training.</p>
                </div>
                <div class="card">
                    <h4>Fault Injection</h4>
                    <p>Built-in mechanisms to simulate network jitter, packet loss, and simulator failures to stress-test control logic.</p>
                </div>
            </div>

            <h3>Research Objectives</h3>
            <ul style="column-count: 2; column-gap: 2rem;">
                <li>Evaluate <strong>traffic signal control strategies</strong> under realistic API workloads.</li>
                <li>Benchmark <strong>reinforcement learning (RL)</strong> against rule-based controllers.</li>
                <li>Simulate <strong>high-frequency vehicle and sensor data streams</strong>.</li>
                <li>Measure <strong>latency, throughput, and stability</strong> of traffic-management APIs.</li>
                <li>Support <strong>reproducible experiments</strong> for academic publication.</li>
            </ul>
        </section>

        <!-- SECTION 2: ARCHITECTURE -->
        <section id="architecture">
            <h2>System Architecture</h2>
            <p>The system integrates Node.js for orchestration, Go for high-performance load generation, and supports multiple simulation backends via a unified interface.</p>
            
            <div class="ascii-diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     REST / gRPC     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Go Load     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  Node.js API     â”‚
â”‚  Generators  â”‚                    â”‚  Gateway         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²                                      â”‚
        â”‚ Metrics / Events                     â”‚
        â”‚                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Simulators â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ Simulation       â”‚
â”‚ (City/SUMO)  â”‚   Control Actions  â”‚ Services         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Data Storage &   â”‚
â”‚ Experiment Logs  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </div>
        </section>

        <!-- SECTION 3: PROJECT STRUCTURE -->
        <section id="structure">
            <h2>Project Structure</h2>
            <p>A research-oriented modular layout separating API logic, domain models, and infrastructure concerns.</p>
            <div class="grid">
                <div class="card">
                    <h4><span class="code-block">src/api</span></h4>
                    <p>Experiment control endpoints, traffic state ingestion, and control action dispatch.</p>
                </div>
                <div class="card">
                    <h4><span class="code-block">src/domain</span></h4>
                    <p>Traffic entities (Vehicle, Lane), flow/density models, and scenario definitions.</p>
                </div>
                <div class="card">
                    <h4><span class="code-block">src/adapters</span></h4>
                    <p><strong>New:</strong> Abstract simulator interfaces for CityFlow and TraCI (SUMO).</p>
                </div>
                <div class="card">
                    <h4><span class="code-block">go/</span></h4>
                    <p>High-throughput traffic event generators and performance monitoring tools.</p>
                </div>
            </div>
        </section>

        <!-- SECTION 4: DEPLOYMENT -->
        <section id="deployment">
            <h2>Deployment & Reproducibility</h2>
            <p>Designed for rigorous academic standards, ensuring results are repeatable and publishable.</p>
            <div class="grid">
                <div class="card" style="border-left: 4px solid var(--primary);">
                    <h4>Modes</h4>
                    <ul>
                        <li>Local research environment</li>
                        <li>Docker-based experiment runner</li>
                        <li>CI-driven automated benchmarking</li>
                        <li>Cloud-based large-scale simulation</li>
                    </ul>
                </div>
                <div class="card" style="border-left: 4px solid var(--success);">
                    <h4>Quality Assurance</h4>
                    <ul>
                        <li>Versioned experiment configurations</li>
                        <li>Deterministic simulation seeds</li>
                        <li>Containerized environments</li>
                        <li>CI-backed experiment validation</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- SECTION 5: CITYFLOW INTEGRATION -->
        <section id="cityflow">
            <h2>CityFlow Integration</h2>
            <p>The platform integrates seamlessly with CityFlow, supporting step-based simulation, real-time polling, and batch execution.</p>
            
            <h3>Explicit API Mapping</h3>
            <p>The Test API wraps CityFlow core functions with validation, logging, and fault tolerance.</p>
            <table>
                <thead>
                    <tr>
                        <th>Test API Responsibility</th>
                        <th>CityFlow API Call</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Initialize simulation</td>
                        <td><code>Engine(config.json)</code></td>
                        <td>Load road network & flows</td>
                    </tr>
                    <tr>
                        <td>Advance simulation</td>
                        <td><code>engine.next_step()</code></td>
                        <td>Move simulation forward</td>
                    </tr>
                    <tr>
                        <td>Get state</td>
                        <td><code>get_lane_vehicles()</code> / <code>get_vehicle_speed()</code></td>
                        <td>Retrieve vehicle IDs & speeds</td>
                    </tr>
                    <tr>
                        <td>Estimate queues</td>
                        <td><code>get_lane_waiting_vehicle_count()</code></td>
                        <td>Count waiting vehicles</td>
                    </tr>
                    <tr>
                        <td>Apply control</td>
                        <td><code>set_traffic_light_phase()</code></td>
                        <td>Change signal phase</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- SECTION 6: SUMO COMPATIBILITY -->
        <section id="sumo">
            <h2>Multi-Simulator Support (SUMO)</h2>
            <p>To address simulator dependency, we introduce an <strong>Abstraction Layer</strong>. This allows the same RL algorithms and API workloads to run on <strong>SUMO (Simulation of Urban MObility)</strong> without code changes in the control logic.</p>

            <div class="ascii-diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Experiment Orchestrator         â”‚
â”‚         (Node.js / Python SDK)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ (Standardized Interface)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Simulator Adapter Interface       â”‚
â”‚  - get_state(lane_id)                  â”‚
â”‚  - set_phase(intersection_id, phase)   â”‚
â”‚  - step()                              â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                      â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CityFlow    â”‚      â”‚  SUMO Adapter â”‚
â”‚ Adapter     â”‚      â”‚  (TraCI)      â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CityFlow    â”‚      â”‚  SUMO Engine  â”‚
â”‚ Engine      â”‚      â”‚  (sumo-gui)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </div>

            <h3>TraCI Integration</h3>
            <p>The SUMO adapter communicates via the <strong>TraCI</strong> (Traffic Control Interface) protocol. The platform handles:</p>
            <ul>
                <li><strong>Coordinate Transformation:</strong> Converting SUMO Cartesian coordinates to lane-based logic.</li>
                <li><strong>Phase Mapping:</strong> Translating SUMO traffic light programs (TLS) to discrete phase indices.</li>
                <li><strong>Subscription Optimization:</strong> Using TraCI subscriptions to reduce API overhead compared to polling.</li>
            </ul>

            <h3>Benefit</h3>
            <p>Researchers can now train a policy in the fast CityFlow engine and deploy/validate it in the highly detailed SUMO environment using the exact same API endpoints.</p>
        </section>

        <!-- SECTION 7: WORKFLOW -->
        <section id="workflow">
            <h2>Experiment Workflow</h2>
            <p>A standardized pipeline for conducting traffic simulation experiments.</p>
            <div class="ascii-diagram">
1. Define scenario and traffic demand
   â”‚
2. Select Simulator (CityFlow / SUMO)
   â”‚
3. Configure API endpoints & Agents
   â”‚
4. Run Go-based load and data simulators
   â”‚
5. Collect metrics (queue, delay, throughput)
   â”‚
6. Export results for statistical analysis
            </div>
        </section>

        <!-- SECTION 8: METRICS -->
        <section id="metrics">
            <h2>Metrics & Evaluation</h2>
            <p>The platform supports quantitative evaluation of traffic performance and API stability.</p>
            <div class="grid">
                <div class="card">
                    <h4>Traffic Metrics</h4>
                    <ul>
                        <li>Average vehicle delay</li>
                        <li>Queue length distribution</li>
                        <li>Throughput per intersection</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>System Metrics</h4>
                    <ul>
                        <li>API response latency</li>
                        <li>System stability under load</li>
                        <li>Error rates & recovery time</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>Export Formats</h4>
                    <ul>
                        <li>CSV / JSON</li>
                        <li>Database persistence</li>
                        <li>LaTeX-compatible figures</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- SECTION 9: ROBUSTNESS -->
        <section id="robustness">
            <h2>ğŸ“Š Robustness & Stress Evaluation</h2>
            <p>Beyond ideal simulation, this platform includes a dedicated <strong>Stress-Testing Suite</strong> to evaluate how controllers handle failures, latency, and missing data.</p>
            
            <h3>1. Fault Injection Scenarios</h3>
            <table>
                <thead>
                    <tr>
                        <th>Failure Type</th>
                        <th>Injection Method</th>
                        <th>Research Objective</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="robustness-tag">Network Jitter</span></td>
                        <td>Injected 50ms-200ms API latency</td>
                        <td>Measure impact of lag on RL decision windows.</td>
                    </tr>
                    <tr>
                        <td><span class="robustness-tag">Packet Loss</span></td>
                        <td>Random 5% request dropping</td>
                        <td>Evaluate controller stability with missing state data.</td>
                    </tr>
                    <tr>
                        <td><span class="robustness-tag">Invalid Actions</span></td>
                        <td>Malformed control requests</td>
                        <td>Test API validation and simulator state preservation.</td>
                    </tr>
                    <tr>
                        <td><span class="robustness-tag">Simulator Drift</span></td>
                        <td>Desynced step-skipping</td>
                        <td>Test robustness of asynchronous control loops.</td>
                    </tr>
                    <tr>
                        <td><span class="robustness-tag">Overload</span></td>
                        <td>2x Peak Traffic Demand</td>
                        <td>Identify the breaking point of queue-clearing algorithms.</td>
                    </tr>
                </tbody>
            </table>

            <h3>2. Stability Metrics</h3>
            <p>We use the <strong>System Recovery Index (SRI)</strong> to quantify how quickly a controller restores normal traffic flow after a fault injection.</p>
            <div class="ascii-diagram">
SRI = (T_recovery - T_fault) / (Delay_max / Delay_baseline)

[ Normal Flow ] ----> [ FAULT INJECTED ] ----> [ OSCILLATION ] ----> [ RECOVERY ]
      (A)                     (B)                    (C)                 (D)
            </div>

            <h3>3. Robustness Results (Comparative)</h3>
            <table>
                <thead>
                    <tr>
                        <th>Strategy</th>
                        <th>Throughput (Ideal)</th>
                        <th>Throughput (10% Lag)</th>
                        <th>Degradation</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Fixed-Time</td>
                        <td>1820 veh/h</td>
                        <td>1815 veh/h</td>
                        <td><span style="color: var(--success); font-weight: 600;">â†“ 0.3%</span></td>
                    </tr>
                    <tr>
                        <td>Actuated</td>
                        <td>1985 veh/h</td>
                        <td>1720 veh/h</td>
                        <td><span style="color: var(--warning); font-weight: 600;">â†“ 13.3%</span></td>
                    </tr>
                    <tr>
                        <td>RL-DeepQ</td>
                        <td>2150 veh/h</td>
                        <td>1650 veh/h</td>
                        <td><span style="color: var(--danger); font-weight: 600;">â†“ 23.2%</span></td>
                    </tr>
                </tbody>
            </table>
            <blockquote style="border-left: 4px solid var(--warning); background: #fffbeb; padding: 1rem; border-radius: 0 8px 8px 0;">
                <strong>Insight:</strong> While RL performs best in ideal conditions, it is significantly more sensitive to API latency compared to simpler rule-based controllers.
            </blockquote>
        </section>

        <!-- SECTION 10: SINGLE AGENT RL LOOP -->
        <section id="rl-loop">
            <h2>Reinforcement Learning Loop</h2>
            <p>The platform natively supports <strong>closed-loop reinforcement learning (RL)</strong> for traffic signal control.</p>
            
            <div class="ascii-diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Simulator  â”‚  (CityFlow / SUMO)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ State: queue, speed, density
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RL Agent   â”‚  (DQN / PPO / A2C)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Action: signal phase, timing
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Traffic API â”‚  (Node.js Gateway)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Apply control
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Simulator  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Reward: delay, throughput
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â–¼
                  Policy Update
            </div>

            <div class="grid">
                <div class="card" style="border-left: 4px solid var(--primary)">
                    <strong>State Space</strong>
                    <ul>
                        <li>Queue length per lane</li>
                        <li>Average vehicle speed</li>
                        <li>Lane occupancy / density</li>
                        <li>Signal phase encoding</li>
                    </ul>
                </div>
                <div class="card" style="border-left: 4px solid var(--success)">
                    <strong>Action Space</strong>
                    <ul>
                        <li>Phase selection</li>
                        <li>Phase duration adjustment</li>
                        <li>Adaptive green splitting</li>
                    </ul>
                </div>
                <div class="card" style="border-left: 4px solid var(--warning)">
                    <strong>Reward Function</strong>
                    <div class="math-block" style="margin: 1rem 0; padding: 1rem; font-size: 0.9rem;">
                        R = -(wâ‚Â·Delay + wâ‚‚Â·Queue + wâ‚ƒÂ·Pressure)
                    </div>
                    <small style="color: var(--secondary); display:block; margin-top:0.5rem">Includes penalties for phase switching and stops.</small>
                </div>
            </div>
        </section>

        <!-- SECTION 11: MARL -->
        <section id="marl">
            <h2>ğŸ•¸ï¸ Multi-Agent Reinforcement Learning (MARL)</h2>
            <p>For city-scale control, we support <strong>Multi-Agent RL</strong> where each intersection acts as an independent agent. We utilize a <strong>Centralized Training, Decentralized Execution (CTDE)</strong> paradigm (e.g., MAPPO or MADDPG).</p>

            <h3>Cooperative Architecture</h3>
            <div class="ascii-diagram">
         [ Global Critic / Value Network ]
                      â–²
                      | (Gradient Feedback)
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚              â”‚
   [Agent A]     [Agent B]      [Agent C]
 (Intersection) (Intersection) (Intersection)
        â”‚             â”‚              â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚             â”‚
         [Communication /  Partial Observ.]
          Feature Sharing
            </div>

            <h3>Mathematical Formulation</h3>
            
            <div class="math-block">
                <strong>1. Joint Action Space</strong><br>
                At time step <i>t</i>, the joint action <b>a</b> taken by <i>N</i> agents is:<br>
                <b>a</b><sup>t</sup> = ( a<sub>1</sub><sup>t</sup>, a<sub>2</sub><sup>t</sup>, ..., a<sub>N</sub><sup>t</sup> )
            </div>

            <div class="math-block">
                <strong>2. Shared Global Reward</strong><br>
                To promote cooperation, agents optimize a global reward function <i>R</i><sub>total</sub> rather than local rewards. This mitigates the "greedy agent" problem where one intersection clears its queue by pushing traffic to a neighbor.<br><br>
                <i>R</i><sub>total</sub>(<b>s</b>, <b>a</b>) = &sum;<sub>i=1</sub><sup>N</sup> ( &alpha; &middot; Delay<sub>i</sub> + &beta; &middot; Queue<sub>i</sub> + &gamma; &middot; Stop<sub>i</sub> )
            </div>

            <div class="math-block">
                <strong>3. Centralized Critic Update (MAPPO Style)</strong><br>
                During training, a centralized critic <i>V</i><sub>&phi;</sub>(<b>o</b>, <b>a</b>) estimates the value of the joint state and action, providing stable gradients for decentralized policy updates.<br><br>
                &nabla;<sub>&theta;</sub> <i>J</i>(&theta;) = &E;<sub>(&tau;, &pi;<sub>&theta;</sub>)</sub>[ &sum;<sub>t</sub> &nabla;<sub>&theta;</sub> log &pi;<sub>&theta;</sub>( a<sub>i</sub><sup>t</sup> | o<sub>i</sub><sup>t</sup> ) &middot; <i>A</i><sub>i</sub>(<b>o</b><sup>t</sup>, <b>a</b><sup>t</sup>) ]
            </div>
        </section>

        <!-- SECTION 12: COMPARISON -->
        <section id="comparison">
            <h2>Control Strategy Comparison</h2>
            <p>Systematic comparison of three major traffic signal control paradigms.</p>
            
            <div class="grid">
                <div class="card">
                    <h3>1. Fixed-Time</h3>
                    <p>Predefined phases and cycle lengths. No adaptation. Low computational cost but poor performance under fluctuating demand.</p>
                    <span class="badge">Baseline</span>
                </div>
                <div class="card">
                    <h3>2. Actuated</h3>
                    <p>Adapts based on detector input using threshold logic. Moderate adaptability but sensitive to detector placement.</p>
                    <span class="badge">Intermediate</span>
                </div>
                <div class="card">
                    <h3>3. RL-Based</h3>
                    <p>Learns optimal policies via interaction. High adaptability and scalability, but requires training.</p>
                    <span class="badge" style="background: var(--primary-light); color: var(--primary); border-color: var(--primary);">Advanced</span>
                </div>
            </div>

            <h3>Quantitative Comparison</h3>
            <table>
                <thead>
                    <tr>
                        <th>Strategy</th>
                        <th>Avg Delay (s)</th>
                        <th>Avg Queue</th>
                        <th>Throughput (veh/h)</th>
                        <th>Adaptability</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Fixed-Time</td>
                        <td>42.6</td>
                        <td>17.4</td>
                        <td>1820</td>
                        <td>None</td>
                    </tr>
                    <tr>
                        <td>Actuated</td>
                        <td>34.1</td>
                        <td>13.6</td>
                        <td>1985</td>
                        <td>Medium</td>
                    </tr>
                    <tr>
                        <td><strong>RL-Based (MARL)</strong></td>
                        <td><strong>28.9</strong></td>
                        <td><strong>10.2</strong></td>
                        <td><strong>2150</strong></td>
                        <td>High</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- SECTION 13: RESULTS -->
        <section id="results">
            <h2>Results & Analysis</h2>
            <p>The platform produces <strong>publication-ready experimental results</strong>. Below is an example of an experiment comparing a Baseline Controller against an RL Controller.</p>

            <table>
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Baseline Control</th>
                        <th>RL Controller</th>
                        <th>Improvement</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Avg Vehicle Delay (s)</td>
                        <td>42.6</td>
                        <td>28.9</td>
                        <td><span style="color: var(--success); font-weight: 600;">â†“ 32.1%</span></td>
                    </tr>
                    <tr>
                        <td>Avg Queue Length (vehicles)</td>
                        <td>17.4</td>
                        <td>10.2</td>
                        <td><span style="color: var(--success); font-weight: 600;">â†“ 41.3%</span></td>
                    </tr>
                    <tr>
                        <td>Throughput (veh/hour)</td>
                        <td>1820</td>
                        <td>2150</td>
                        <td><span style="color: var(--success); font-weight: 600;">â†‘ 18.1%</span></td>
                    </tr>
                    <tr>
                        <td>API Latency (ms, p95)</td>
                        <td>96</td>
                        <td>104</td>
                        <td>+8.3%</td>
                    </tr>
                    <tr>
                        <td>System Stability (crash rate)</td>
                        <td>Stable</td>
                        <td>Stable</td>
                        <td>â€”</td>
                    </tr>
                </tbody>
            </table>

            <h3>Supported Plots</h3>
            <p>Results can be visualized and exported directly into LaTeX-compatible figures:</p>
            <ul style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                <li>Vehicle delay vs. time</li>
                <li>Queue length distribution</li>
                <li>Throughput comparison</li>
                <li>API latency under load</li>
                <li>Reward convergence (RL)</li>
            </ul>
        </section>

        <!-- SECTION 14: LIMITATIONS & FUTURE (IMPROVED CONTENT) -->
        <section id="limitations">
            <h2>Limitations & Future Work</h2>
            
            <h3>Current Limitations</h3>
            <div class="grid">
                <div class="card">
                    <h4>Discrete-Time Assumption</h4>
                    <p>Fixed-step simulation assumes synchronous timing, ignoring real-world jitter and noise.</p>
                    <div class="impact-box">
                        <small><strong>Impact:</strong> Latency modeling is simplified.</small>
                    </div>
                </div>
                <div class="card">
                    <h4>Simplified Demand</h4>
                    <p>Relies on pre-configured demand files. Lacks incidents, weather, and mixed traffic (pedestrians).</p>
                    <div class="impact-box">
                        <small><strong>Impact:</strong> Policies may overfit to repetitive patterns.</small>
                    </div>
                </div>
                <div class="card">
                    <h4>Reactive Error Handling</h4>
                    <p>Failures are mitigated after occurrence, not predicted or learned against.</p>
                    <div class="impact-box">
                        <small><strong>Impact:</strong> No explicit reliability signal in the learning loop.</small>
                    </div>
                </div>
            </div>

            <h3>Future Work: Advanced Control Principles</h3>
            <p>We propose specific theoretical and practical improvements for the v3.0 roadmap, moving beyond standard RL to theory-driven control.</p>
            
            <div class="grid">
                <div class="card" style="border-top: 4px solid var(--primary);">
                    <h4>1. Max-Pressure Control</h4>
                    <p><strong>Theory:</strong> Implement phase-free control based on queue pressure differentials ($P = \lambda_{in} - \lambda_{out}$).</p>
                    <p><strong>Goal:</strong> Maximize network throughput stability without pre-defined cycles.</p>
                </div>
                <div class="card" style="border-top: 4px solid var(--success);">
                    <h4>2. Platoon-Based Control</h4>
                    <p><strong>Theory:</strong> V2X integration to identify vehicle clusters. Prioritize servicing platoons over individual vehicles.</p>
                    <p><strong>Goal:</strong> Minimize stop-and-go waves and fuel consumption.</p>
                </div>
                <div class="card" style="border-top: 4px solid var(--warning);">
                    <h4>3. Robust MDPs</h4>
                    <p><strong>Theory:</strong> Train agents using Min-Max optimization against worst-case state ambiguity.</p>
                    <p><strong>Goal:</strong> Ensure safety and stability even with sensor noise or packet loss.</p>
                </div>
                <div class="card" style="border-top: 4px solid var(--danger);">
                    <h4>4. Eco-Driving Rewards</h4>
                    <p><strong>Theory:</strong> Integrate VT-Micro emission models into the reward function.</p>
                    <p><strong>Goal:</strong> Shift optimization from "Time Minimization" to "Energy Minimization".</p>
                </div>
            </div>
        </section>

        <!-- SECTION 15: CITATION -->
        <section id="citation">
            <h2>Citation</h2>
            <p>If you use this platform in academic work, please cite it as follows:</p>
            <div class="citation-box">
                <button class="copy-btn" onclick="copyCitation()">Copy BibTeX</button>
                <pre id="bibtex" style="background: transparent; border: none; padding: 0; color: #e2e8f0; font-family: 'Fira Code', monospace; font-size: 0.9rem;">
@software{traffic_api_platform,
  title  = {Web API Test Platform for Traffic Simulation},
  author = {Ahmed Albreem},
  year   = {2026},
  note   = {Multi-simulator support for CityFlow and SUMO with MARL capabilities}
}</pre>
            </div>
        </section>
    </main>

    <script>
        // 1. Reading Progress Bar
        window.onscroll = function() {
            let winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            let height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            let scrolled = (winScroll / height) * 100;
            document.getElementById("progressBar").style.width = scrolled + "%";
            
            highlightSidebar();
        };

        // 2. Mobile Menu Toggle
        function toggleMobileMenu() {
            document.getElementById('sidebar').classList.toggle('mobile-open');
        }

        // 3. Sidebar Highlighting
        function highlightSidebar() {
            const sections = document.querySelectorAll("section");
            const navLinks = document.querySelectorAll("nav a");
            let current = "";

            sections.forEach((section) => {
                const sectionTop = section.offsetTop;
                if (pageYOffset >= (sectionTop - 200)) {
                    current = section.getAttribute("id");
                }
            });

            navLinks.forEach((a) => {
                a.classList.remove("active");
                if (a.getAttribute("href").includes(current)) {
                    a.classList.add("active");
                }
            });
        }

        // 4. Copy Citation Logic
        function copyCitation() {
            const text = document.getElementById("bibtex").innerText;
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.querySelector(".copy-btn");
                const originalText = btn.innerText;
                btn.innerText = "Copied!";
                btn.style.background = "#10b981";
                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.style.background = "rgba(255,255,255,0.1)";
                }, 2000);
            });
        }
    </script>
</body>
</html>
